From 5185a858acedb087c798b0300e8e477600d1b29a Mon Sep 17 00:00:00 2001
From: xiong-qiushi <xiong_123ing@163.com>
Date: Thu, 1 Aug 2024 18:07:49 +0800
Subject: [PATCH 1/1] patch

---
 Makefile.am                   | 2 +-
 configure.ac                  | 4 ++--
 libpam/pam_modutil_getspnam.c | 2 +-
 libpam/pam_private.h          | 2 +-
 4 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 8a2e31dd..e9b7c38d 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -4,7 +4,7 @@
 
 AUTOMAKE_OPTIONS = 1.9 gnu dist-xz no-dist-gzip check-news
 
-SUBDIRS = libpam_internal libpam tests libpamc libpam_misc modules po conf \
+SUBDIRS = libpam_internal libpam tests libpamc libpam_misc po conf \
 	  xtests
 
 if HAVE_DOC
diff --git a/configure.ac b/configure.ac
index fc5cc085..bb28e03f 100644
--- a/configure.ac
+++ b/configure.ac
@@ -313,11 +313,11 @@ if test x"$enable_pamlocking" = "xyes"; then
 fi
 
 AC_ARG_ENABLE(read-both-confs,
-	AS_HELP_STRING([--enable-read-both-confs],[read both /etc/pam.d and /etc/pam.conf files]))
+	AS_HELP_STRING([--enable-read-both-confs],[read both /etc/pam.d and /data/tpc_c_cplusplus/thirdparty/linux-pam/pam.conf files]))
 
 if test x"$enable_read_both_confs" = "xyes"; then
    AC_DEFINE([PAM_READ_BOTH_CONFS],,
-		[read both /etc/pam.d and /etc/pam.conf files])
+		[read both /etc/pam.d and /data/tpc_c_cplusplus/thirdparty/linux-pam/pam.conf files])
 fi
 
 AC_ARG_ENABLE([lckpwdf],
diff --git a/libpam/pam_modutil_getspnam.c b/libpam/pam_modutil_getspnam.c
index 8b48db90..c6756b06 100644
--- a/libpam/pam_modutil_getspnam.c
+++ b/libpam/pam_modutil_getspnam.c
@@ -119,7 +119,7 @@ pam_modutil_getspnam(pam_handle_t *pamh, const char *user)
      * getspnam(). So, we use the standard libc function.
      */
 
-    return getspnam(user);
+//    return getspnam(user);
 
 #endif /* def HAVE_GETSPNAM_R */
 }
diff --git a/libpam/pam_private.h b/libpam/pam_private.h
index 77dc5a69..0880bf9c 100644
--- a/libpam/pam_private.h
+++ b/libpam/pam_private.h
@@ -25,7 +25,7 @@
 
 /* the Linux-PAM configuration file */
 
-#define PAM_CONFIG         "/etc/pam.conf"
+#define PAM_CONFIG         "/data/pam.conf"
 #define PAM_CONFIG_D       "/etc/pam.d"
 #define PAM_CONFIG_DF      "/etc/pam.d/%s"
 #define PAM_CONFIG_DIST_D  "/usr/lib/pam.d"
-- 
2.34.1

