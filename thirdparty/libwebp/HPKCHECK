# Contributor: liucheng <1596268623@qq.com>
# Maintainer:  liucheng <1596268623@qq.com>

source HPKBUILD > /dev/null 2>&1
logfile=${LYCIUM_THIRDPARTY_ROOT}/${pkgname}/${pkgname}_${ARCH}_${OHOS_SDK_VER}_test.log

openharmonycheck() {
    res=0
    cd ${builddir}/${ARCH}-build

    ./cwebp ../examples/test_ref.ppm  -q 80 -o output.webp > $logfile 2>&1
    res=$?
    if [ $res -ne 0 ]
    then
        cd $OLDPWD
        return $res
    else
        mkdir -p ${LYCIUM__MANUAL_CONFIRM_PATH}/${pkgname}
        cp output.webp ${LYCIUM__MANUAL_CONFIRM_PATH}/${pkgname}/
    fi

    ./dwebp output.webp -ppm -o test.ppm > $logfile 2>&1
    res=$?
    if [ $res -ne 0 ]
    then
        cd $OLDPWD
        return $res
    else
        mkdir -p ${LYCIUM__MANUAL_CONFIRM_PATH}/${pkgname}
        cp ./test.ppm ${LYCIUM__MANUAL_CONFIRM_PATH}/${pkgname}/
    fi

    cd $OLDPWD

    return $res
}
